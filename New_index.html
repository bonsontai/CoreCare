<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoreCare - 智能健康訓練平台</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* --- 基礎設定 --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --bg-color: #f4f7f6;
            --text-color: #333;
            --nav-bg: #fff;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        /* --- 導覽列 (Navbar) --- */
        header {
            background-color: var(--nav-bg);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-color);
            text-decoration: none;
            letter-spacing: 1px;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 20px;
            margin: 0;
            padding: 0;
            align-items: center;
        }

        .nav-links li {
            position: relative;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--text-color);
            font-weight: 500;
            padding: 0.5rem 1rem;
            transition: color 0.3s;
            cursor: pointer;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: var(--primary-color);
        }

        /* 下拉選單 (Dropdown) */
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #fff;
            min-width: 160px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            top: 100%;
            left: 0;
            z-index: 1;
            border-radius: 4px;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }

        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

        .dropdown-content a:hover {
            background-color: #f1f1f1;
        }

        /* 漢堡選單按鈕 (Mobile) */
        .hamburger {
            display: none;
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* --- 主內容區塊 --- */
        main {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
            min-height: 80vh;
        }

        .section {
            display: none;
            /* 預設隱藏所有區塊 */
            animation: fadeIn 0.5s;
        }

        .section.active-section {
            display: block;
            /* 顯示當前區塊 */
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* --- 首頁樣式 --- */
        .hero {
            text-align: center;
            padding: 5rem 1rem;
            background: linear-gradient(135deg, #007bff 0%, #00d2ff 100%);
            color: white;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        /* --- 個人頁面樣式 --- */
        .personal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .filter-select {
            padding: 10px;
            font-size: 1rem;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .data-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: var(--card-shadow);
        }

        .data-list p {
            border-bottom: 1px solid #eee;
            padding: 8px 0;
            display: flex;
            justify-content: space-between;
        }

        .data-list span {
            font-weight: bold;
            color: var(--primary-color);
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        /* --- 訓練頁面樣式 --- */
        .training-card {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: var(--card-shadow);
            text-align: center;
            margin-top: 2rem;
        }

        .training-result h3 {
            color: var(--primary-color);
            font-size: 2rem;
            margin: 10px 0;
        }

        .level-badge {
            background-color: #28a745;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            vertical-align: middle;
        }

        /* --- 響應式設計 (RWD) --- */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
                flex-direction: column;
                width: 100%;
                background-color: white;
                position: absolute;
                top: 60px;
                left: 0;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            }

            .nav-links.active {
                display: flex;
            }

            .nav-links li {
                width: 100%;
                text-align: center;
            }

            .dropdown-content {
                position: static;
                box-shadow: none;
                background-color: #f9f9f9;
                display: none;
                /* Mobile預設摺疊 */
            }

            .dropdown.active .dropdown-content {
                display: block;
            }

            .hamburger {
                display: block;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>

    <header>
        <nav>
            <a href="#" class="logo" onclick="navigateTo('home')">CoreCare</a>
            <div class="hamburger" onclick="toggleMenu()">
                <i class="fas fa-bars"></i>
            </div>
            <ul class="nav-links" id="navLinks">
                <li><a onclick="navigateTo('home')">首頁</a></li>
                <li><a onclick="navigateTo('personal')">個人</a></li>
                <li class="dropdown" onclick="toggleDropdown(this)">
                    <a>訓練 <i class="fas fa-caret-down"></i></a>
                    <div class="dropdown-content">
                        <a onclick="loadTraining('squat')">深蹲訓練</a>
                        <a onclick="loadTraining('kettlebell')">壺鈴訓練</a>
                        <a onclick="loadTraining('sitting')">坐姿訓練</a>
                    </div>
                </li>
            </ul>
        </nav>
    </header>

    <main>
        <section id="home" class="section active-section">
            <div class="hero">
                <h1>歡迎來到 CoreCare</h1>
                <p>您的智能姿勢矯正與健康訓練夥伴</p>
                <button onclick="navigateTo('personal')"
                    style="margin-top: 20px; padding: 10px 20px; cursor: pointer; border: none; background: white; color: #007bff; border-radius: 5px; font-weight: bold;">查看我的數據</button>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                <div class="data-card">
                    <h3><i class="fas fa-bullseye"></i> 精準追蹤</h3>
                    <p>實時監控您的訓練姿勢，提供即時反饋。</p>
                </div>
                <div class="data-card">
                    <h3><i class="fas fa-chart-line"></i> 數據分析</h3>
                    <p>透過雷達圖分析您的投入度與掌握度。</p>
                </div>
                <div class="data-card">
                    <h3><i class="fas fa-dumbbell"></i> 智能推薦</h3>
                    <p>根據您的表現自動調整訓練強度。</p>
                </div>
            </div>
        </section>

        <section id="personal" class="section">
            <div class="personal-header">
                <h2>個人訓練數據</h2>
                <select id="statsType" class="filter-select" onchange="updatePersonalData()">
                    <option value="squat">深蹲數據</option>
                    <option value="kettlebell">壺鈴數據</option>
                    <option value="sitting">坐姿數據</option>
                </select>
            </div>

            <div class="stats-grid">
                <div class="data-card">
                    <h3>詳細數據</h3>
                    <div class="data-list" id="dataListContent">
                    </div>
                </div>

                <div class="data-card">
                    <h3>能力分析雷達圖</h3>
                    <div class="chart-container">
                        <canvas id="radarChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <section id="training" class="section">
            <h2>今日訓練計畫</h2>
            <div id="trainingContent">
                <p>請從選單中選擇一項訓練。</p>
            </div>
        </section>
    </main>

    <script>
        // --- 資料庫模擬 (Mock Data) ---
        // 假設這是從後端抓取的使用者歷史紀錄與建議
        let globalUserData = {}; // 用來存讀取到的 CSV 資料

        // 讀取 CSV 檔案 (整合您的 person.csv)
        function fetchCsvData() {
            Papa.parse("person.csv", {
                download: true,
                header: true,
                complete: function (results) {
                    console.log("CSV 讀取成功:", results.data);
                    processCsvData(results.data);
                },
                error: function (err) {
                    console.error("無法讀取 person.csv", err);
                    // 讀取失敗時使用預設假資料，避免版面空白
                    useMockData();
                }
            });
        }

        // 將 CSV 資料轉換成我們 UI 需要的格式
        function processCsvData(data) {
            // 假設 CSV 欄位是: Time, Posture, Result, SquatError, SquatCorrect, ...
            // 您需要在這裡寫一點邏輯，抓出「最新的一筆」資料

            const latest = data[data.length - 1]; // 抓最後一筆

            // 更新全域變數 (這只是範例，需依照您 CSV 真實欄位名稱修改)
            globalUserData = {
                squat: {
                    time: latest.Time || 'N/A',
                    posture: '深蹲',
                    result: latest.Result || 'N/A',
                    errorCount: latest.SquatError || 0,
                    correctCount: latest.SquatCorrect || 0,
                    suggestionText: latest.Suggestion || '持續保持！',
                    // 假設 CSV 有紀錄雷達圖分數，沒有的話就先給預設值
                    radar: [80, 70, 60, 90]
                },
                // ... 重複設定 kettlebell 和 sitting
            };

            // 資料讀取完後，重新整理畫面
            updatePersonalData();
        }

        // 在頁面載入時執行
        window.onload = function () {
            fetchCsvData();
            // 預設顯示首頁
            navigateTo('home');
        };

        // 訓練項目對應表 (依照需求設定)
        const trainingLevels = {
            squat: {
                lower: '扶椅深蹲',
                middle: '座椅深蹲',
                upper: '徒手深蹲'
            },
            kettlebell: {
                lower: '壺鈴站立提拉',
                middle: '壺鈴提舉',
                upper: '壺鈴擺盪 (Swing)' // 補充一個 upper 以防萬一
            },
            sitting: {
                lower: '坐姿基礎',
                middle: '坐姿中級',
                upper: '坐姿高階'
            }
        };

        // --- 全域變數 ---
        let myRadarChart = null;

        // --- 導覽列邏輯 ---
        function toggleMenu() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('active');
        }

        // Mobile 下拉選單點擊展開
        function toggleDropdown(element) {
            if (window.innerWidth <= 768) {
                element.classList.toggle('active');
            }
        }

        // --- 頁面切換邏輯 (SPA) ---
        function navigateTo(pageId) {
            // 隱藏所有區塊
            document.querySelectorAll('.section').forEach(sec => {
                sec.classList.remove('active-section');
            });
            // 顯示目標區塊
            document.getElementById(pageId).classList.add('active-section');

            // 關閉手機版選單
            document.getElementById('navLinks').classList.remove('active');

            // 如果進入個人頁面，初始化數據
            if (pageId === 'personal') {
                updatePersonalData();
            }
        }

        // --- 個人頁面邏輯 ---
        function updatePersonalData() {
            const type = document.getElementById('statsType').value; // squat, kettlebell, sitting
            const data = userDatabase[type];

            // 1. 更新文字數據列表
            // 這裡動態生成該類別對應的錯誤/正確次數標籤
            let specificErrorLabel = '';
            let specificCorrectLabel = '';

            if (type === 'squat') { specificErrorLabel = '深蹲錯誤次數'; specificCorrectLabel = '深蹲正確次數'; }
            else if (type === 'kettlebell') { specificErrorLabel = '壺鈴錯誤次數'; specificCorrectLabel = '壺鈴正確次數'; }
            else { specificErrorLabel = '坐姿錯誤次數'; specificCorrectLabel = '坐姿正確次數'; }

            const listHtml = `
                <p>時間: <span>${data.time}</span></p>
                <p>訓練姿勢: <span>${data.posture}</span></p>
                <p>訓練結果: <span>${data.result}</span></p>
                <p>${specificErrorLabel}: <span style="color:red">${data.errorCount}</span></p>
                <p>${specificCorrectLabel}: <span style="color:green">${data.correctCount}</span></p>
                <p>建議 (${type}): <span>${data.suggestionText}</span></p>
            `;
            document.getElementById('dataListContent').innerHTML = listHtml;

            // 2. 更新雷達圖
            updateRadarChart(data.radar);
        }

        function updateRadarChart(dataValues) {
            const ctx = document.getElementById('radarChart').getContext('2d');

            // 如果圖表已存在，先銷毀舊的
            if (myRadarChart) {
                myRadarChart.destroy();
            }

            myRadarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['姿勢準確度', '等級掌握度', '穩定性分數', '總體投入度'],
                    datasets: [{
                        label: '能力指標',
                        data: dataValues,
                        backgroundColor: 'rgba(0, 123, 255, 0.2)',
                        borderColor: 'rgba(0, 123, 255, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(0, 123, 255, 1)'
                    }]
                },
                options: {
                    scales: {
                        r: {
                            angleLines: { display: true },
                            suggestedMin: 0,
                            suggestedMax: 100
                        }
                    },
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // --- 訓練頁面邏輯 ---
        function loadTraining(type) {
            const trainingPaths = {
                squat: {
                    lower: 'squats/lower.html',   // 對應您原本的檔案
                    middle: 'squats/middle.html',
                    upper: 'squats/upper.html'
                },
                kettlebell: { // 假設您的壺鈴是對應 advances 資料夾
                    lower: 'advances/lower.html',
                    middle: 'advances/middle.html',
                    upper: 'advances/upper.html'
                },
                sitting: {
                    lower: 'sitting/lower.html',
                    middle: 'sitting/middle.html',
                    upper: 'sitting/upper.html'
                }
            };

            // 2. 模擬讀取您的建議等級 (這裡未來可以換成從後端 API 或 person.csv 讀取)
            function getUserLevel(type) {
                //  TODO: 這裡可以整合您原本 squats_level.js 的邏輯
                // 目前先假設從資料庫讀取到的建議是 'middle'
                // 範例： return userDatabase[type].suggestion || 'middle';
                return 'middle';
            }

            // 3. 修改 loadTraining 函式，執行跳轉
            function loadTraining(type) {
                // 取得使用者的建議等級
                const userLevel = getUserLevel(type);

                // 取得對應的網頁路徑
                const targetUrl = trainingPaths[type][userLevel];

                if (targetUrl) {
                    // --- 關鍵修改：直接跳轉到您原本設計好的網頁 ---
                    console.log(`正在導向至 ${userLevel} 等級的 ${type} 訓練頁面...`);
                    window.location.href = targetUrl;
                } else {
                    alert("尚未建立該訓練等級的頁面！");
                }
            }
        }

        // 初始化：預設載入首頁
        // (HTML結構中已將 #home 設為 active-section，此處無需額外代碼)
    </script>
</body>

</html>